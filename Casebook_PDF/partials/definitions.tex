% DEFINITIONS

% Customize the formatting of verbatim environments.
\usepackage{fancyvrb}
\fvset{fontsize=\normalsize}

% Prints argument within hanging parentheses
\newcommand{\hangp}[1]{\makebox[0pt][r]{(}#1\makebox[0pt][l]{)}}

% Prints an asterisk that takes up no horizontal space.
\newcommand{\hangstar}{\makebox[0pt][l]{*}}

% Prints a trailing space in a smart way.
\usepackage{xspace}

% Prints the month name (e.g., January) and the year (e.g., 2008)
\newcommand{\monthyear}{%
  \ifcase\month\or January\or February\or March\or April\or May\or June\or
  July\or August\or September\or October\or November\or
  December\fi\space\number\year
}

\newcommand{\marginfont}{\color{RacingGreen}\sffamily\scriptsize}

% Prints an epigraph and speaker in sans serif, all-caps type.
\newcommand{\epigraph}[3]{%
  \begin{fullwidth}
  \begin{flushright}
  \sffamily\fontsize{8}{10}\selectfont
  \sffamily\footnotesize
  \begin{doublespace}
  \vspace{-8cm}\noindent\allcaps{#1}\\% epigraph
  \noindent\faIcon{pen-fancy} ２荛趔栳疱３苘狨翳矧苠钿滹踱戾箴徙妪荟箴徙妍诞便睚苠钿骒躞栩殓梏苠钿骢祆鏖漪椠茴矧磲戽镱茴鬻泔眄犷潲茆灬铍疳珏茴鬻疳珏荑怙荇栝箴徵弩豉戾屙痿茴鬻疳珏轭箦螋淬忮骘蝈聃雉茯孱鬻孱鲩蝻铐孱酐聃雉妪莒轶酐莒彐繇狎玳罱钞点碥麸痼屦桨痿荛翦碥蝈灬荏磲祆荛趔栳疱苠钿扉篝汨犷珏汨狃翦骘蝽狒糸铉荇轸戾箴徙轭绐茔栳痿弪梆酏点睚便睚荇轸戾箴徙轭绐荏邈糸镱梆酏窜忉箦扉铄箅轲避忉箦扉铄箅轲荇轸戾箴徙轭绐荏踱箦泗轱铨梆酏曹忉箦扉铄箅轲避忉箦扉铄箅轲荇轸戾箴徙轭绐莛狎徵蜥痂板睚曹忉箦扉铄箅轲弟忉箦扉铄箅轲荇轸戾箴徙轭绐荏踱疳蜥珧狃椠板睚避忉箦扉铄箅轲弟忉箦扉铄箅轲荇轸戾骘蝽狒荏邈糸镱垅祜汶茴鬻疳珏茯徵珏潋殓梏荏骀犴殪荑蹒遘泔祜螓孽祆义潺荇桢箦泗轱
  {0em}
  {}
  []

  % Section title
\titleformat{\subsection}
  [block]
  {\needspace{5\baselineskip}\raggedright\sffamily\LARGE\color{DullRed}}
  {\thesubsection ~}
  {0em}
  {}
  []

% Case, etc. title
\titleclass{\subsubsection}{straight}
\titleformat{\subsubsection}
  [block]
  {\needspace{4\baselineskip}\raggedright\rmfamily\Large\color{DullRed}}
  {\theparagraph ~}
  {0em}
  {}
  [\vspace{-1em}\textcolor{DullRed}{\rule{\textwidth}{1pt}}]

% Case, etc. first heading: large, bold 
\titleclass{\paragraph}{straight}
\titleformat{\paragraph}
  [block]
  {\needspace{3\baselineskip}\raggedright\rmfamily\large}
  {\theparagraph ~}
  {0em}
  {}
  []

% Case, etc. second heading: large, italic
\titleclass{\subparagraph}{straight}
\titleformat{\paragraph}
  [block]
  {\needspace{3\subbaselineskip}\raggedright\itshape\large}
  {\thesubparagraph}
  {0em}
  {}
  []

%  Change Figure Caption in the Margin size
% \renewenvironment{@tufte@margin@float}[2][-1.2ex]%
%   {\FloatBarrier% process all floats before this point so the figure/table numbers stay in order.
%   \begin{lrbox}{\@tufte@margin@floatbox}%
%   \begin{minipage}{\marginparwidth}%
%     \@tufte@caption@font\footnotesize% <-- Add fontnotesize
%     \def\@captype{#2}%
%     \hbox{}\vspace*{#1}%
%     \@tufte@caption@justification%
%     \@tufte@margin@par%
%     \noindent\normalsize%<-- restored size
%   }
%   {\end{minipage}%
%   \end{lrbox}%
%   \marginpar{\usebox{\@tufte@margin@floatbox}}%
  % }


% \renewcommand\footnotesize{%
%    \@setfontsize\footnotesize\@viiipt{9}%
%    \abovedisplayskip 5\p@ \@plus2\p@ \@minus4\p@
%    \abovedisplayshortskip \z@ \@plus\p@
%    \belowdisplayshortskip 2.8\p@ \@plus\p@ \@minus2\p@
%    \def\@listi{\leftmargin\leftmargini
%                \topsep 2.5\p@ \@plus\p@ \@minus\p@
%                \parsep 2\p@ \@plus\p@ \@minus\p@
%                \itemsep \parsep}%
%    \belowdisplayskip \abovedisplayskip
% }

% % Define Tuftian float styles (with the caption in the margin)
% \newcommand{\floatc@tufteplain}[2]{%
% \begin{lrbox}{\@tufte@caption@box}%
%   \begin{minipage}[\floatalignment]{\marginparwidth}\hbox{}%
%     \footnotesize\@tufte@caption@font{\@fs@cfont #1:} #2\par\normalsize%
%   \end{minipage}%
% \end{lrbox}%
% \smash{\hspace{\@tufte@caption@fill}\usebox{\@tufte@caption@box}}%
% }